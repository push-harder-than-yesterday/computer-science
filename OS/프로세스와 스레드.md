## (멀티)프로세스와 (멀티)스레드

* [(멀티)프로세스와 (멀티)스레드](#멀티프로세스와-멀티스레드)
  * [프로세스](#프로세스)
  * [프로세스의 상태](#프로세스의-상태)
  * [스레드](#스레드)
  * [멀티 프로세스](#멀티-프로세스)
  * [멀티 스레드](#멀티-스레드)

### 프로세스

프로세스란 수행중인 프로그램을 뜻하며, 수행중이란 뜻은 실행 파일 형태로 존재하던 프로그램이 메모리에 올라가 수행되기 시작하는 것을 말한다. 이러한 프로세스는 CPU를 획득하여 자신의 코드를 수행하거나 CPU를 반환하고 입출력 작업을 수행하기도 한다.

할당받는 시스템 자원

- CPU 시간
- 운영되기 위한 주소 공간
- Code, Data, Stack, Heap의 구조로 되어있는 독립된 메모리 영역.

<img src="https://user-images.githubusercontent.com/33534771/77537773-fe37fb00-6ee1-11ea-8def-4dd11523b5e7.png" />

- 기본적으로 프로세스마다 최소 1개의 스레드를 갖는다.(메인 스레드)
- 프로세스는 각각 별도의 메모리 영역(주소 공간)을 할당받는다.  [Code, Data, Stack, Heap]
- 한 프로세스는 다른 프로세스의 변수나 자료구조에 접근할 수 없으며, 접근을 위해서는 IPC 통신이 필요하다.
  - Ex) 파이프, 파일, 소켓 등을 이용한 통신 방법 이용.

### 프로세스의 상태

- 실행(Running) : 프로세스가 CPU를 보유하고 기계어 명령을 실행하고 있는 상태

- 준비(Ready) : 프로세스가 CPU만 보유하면 당장이라고 명령을 실행할 수 있지만, CPU를 할당받지 못한 상태

- 봉쇄(Blocked, Wait, Sleep) : 프로세스에게 CPU를 할당해 주어도 당장 명령을 실행할 수 없는 상태

- 시작(New) :  프로세스가 시작되어 프로세스를 위한 각종 자료 구조는 생성되었지만 아직 메모리 획득을 승인받지 못한 상태

- 완료(Terminated) : 프로세스가 종료되었으나 운영 체제가 프로세스와 관련된 자료 구조를 완전히 정리하지 못한 상태

![](https://i.imgur.com/JDADmx1.png)



### 스레드

프로세스 안에서 실행되는 여러 흐름 단위로 **스택영역만 따로 할당**받고 나머지 영역은 서로 공유하게 된다.

스레드는 스레드 ID, 프로그램 카운터, 레지스터 집합, 그리고 스택으로 구성된다.

> 스레드마다 스택 영역을 따로 할당받는 이유?
>
> * 스택은 함수 호출시 전달되는 인자, 되돌아갈 주소값, 함수 내에서 선언하는 변수 등을 저장하기 위해 사용되는 메모리 공간이므로 스택 메모리 공간이 독립적이라는 것은 독립적인 함수 호출이 가능하다는 것을 뜻한다. 즉, 스레드의 정의처럼 **독립적인 실행 흐름을 추가하기 위해** 스레드는 독립적인 스택 공간을 사용하게 된다.

`요약`
프로세스는 자신만의 고유 공간과 자원을 할당받아 사용하는데 반해 스레드는 다른 스레드와 공간, 자원을 공유하면서 사용하는 차이가 있다.



### 멀티 프로세스

- 하나의 응용프로그램을 여러 개의 프로세스로 구성하여 각 프로세스가 하나의 작업을 처리하도록 하는 것.
- 장점
  - 여러 개의 자식 프로세스 중 하나에 문제가 발생하면 그 자식 프로세스만 죽는 것 이상으로 다른 영향이 확산되지 않는다. (안전성)
- 단점
  1. Context Switching에서의 오버헤드
     - 프로세스는 각 독립된 메모리 영역을 할당받았기 때문에 공유하는 메모리가 없다. 따라서 캐시 메모리 초기화 등의 무거운 작업이 진행되고 많은 시간이 소모되는 등의 오버헤드가 발생할 문제가 있다.
  2. 프로세스 간 통신 기법 IPC
     - 프로세스는 각 독립된 메모리 영역을 할당받았기 때문에 프로세스들 사이에서 변수나 자료구조를 공유할 수 없다. 따라서 IPC라는 방법을 사용해야 하며, 이는 어렵고 복잡한 통신 방법이다.



### 멀티 스레드

- 하나의 응용 프로그램을 여러 개의 스레드로 구성하고 각 스레드가 하나의 작업을 처리하도록 하는 것.
- 윈도우, 리눅스 등 많은 OS들이 멀티 프로세싱을 지원하고 있지만, 멀티 스레딩을 기본으로 하고 있다.
- 웹 서버는 대표적인 멀티 스레드 응용 프로그램이다.
- 장점
  - 메모리 공간과 시스템 자원 소모가 줄어들게 된다.
  - 스레드 간 통신시, 전역 변수의 공간 또는 동적으로 할당된 공간인 Heap 영역을 이용해 데이터를 주고 받으므로 통신 방법이 간단하다.
  - Context switching 시, 캐시 메모리를 비울 필요가 없기 때문에 비용이 적고 더 빠르다.
  - 따라서 시스템의 처리량이 향상되고 자원 소모가 줄어들며, 자연스럽게 프로그램의 응답 시간이 단축된다.

- 단점
  - 서로 다른 스레드가 Data, Heap 영역 등을 공유하기 때문에 어떤 스레드가 다른 스레드에서 사용중인 변수나 자료구조에 접근하여 엉뚱한 값을 읽어오거나 수정할 수 있다. 즉, 자원 공유의 문제가 발생한다.(동기화)
  - 하나의 스레드에 문제가 생기면 전체 프로세스가 영향을 받는다.
  - 주의 깊은 설계가 필요하며, 디버깅이 까다롭다


`요약`

멀티 스레드는 멀티 프로세스보다 적은 메모리 공간을 차지하고 Context Switching이 빠르다는 장점이 있지만, 오류로 인해 하나의 스레드가 종료되면 전체 스레드가 종료될 수 있다는 점과 동기화 문제를 가지고 있다. 

반면, 멀티 프로세싱 방식은 하나의 프로세스가 죽더라도 다른 프로세스에는 영향을 끼치지 않고 정상적으로 수행된다는 장점이 있지만, 멀티 스레드보다 많은 메모리 공간과 CPU 시간을 차지한다는 단점이 존재한다. 

이 두 가지는 동시에 여러 작업을 수행한다는 점에서 같지만 적용해야 하는 시스템에 따라 적합/부적합이 구분된다. 따라서 대상 시스템의 특징에 따라 적합한 동작 방식을 선택하고 적용해야 한다.
